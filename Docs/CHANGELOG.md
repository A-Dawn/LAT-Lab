# LAT-Lab 更新日志

<div align="center">

**🌍 Languages / 语言选择**

[![简体中文](https://img.shields.io/badge/CHANGELOG-简体中文-blue.svg)](./CHANGELOG.md) [![English](https://img.shields.io/badge/CHANGELOG-English-red.svg)](./CHANGELOG_EN.md)

</div>

本文档记录了 LAT-Lab 项目的所有重要更新。

## [v1.1.0] - 2025-11-12

### 🔐 身份与安全强化
- 新增 `must_change_password` 首登改密策略字段，并通过数据库迁移与登录响应支持，帮助高风险账号在下次登录后强制修改密码。
- 统一以邮箱作为 Token 主体，进一步收紧用户资料更新流程，阻断潜在的权限漂移风险。

### 💬 评论审核流程升级
- 文章评论接口改为按层级构建最多五层的回复树，同时保留每条评论的用户信息，便于前端直接渲染。
- 管理员可在接口层查看待审核评论，而普通用户仍只会看到已通过审核的内容。

### 🛠️ 管理端开发者工具重构
- 全面重构管理后台开发工具界面，引入 `StatusIndicator`、`ElementNavigator`、`ChangeHistory`、`FileExporter` 等独立面板，并优化加载状态提示。
- 新增 iframe 准备握手、元素快照与统一刷新钩子，使样式、文本、布局等多页面编辑保持同步。

### 🧼 内容安全工具
- 新增基于 DOMPurify 的 `sanitizeHtml`、`safelyApplyContent`、`vHtmlSafe` 等工具，在渲染或导出前自动净化 HTML 内容。
- 编辑器可自动识别 HTML 负载并通过新净化层安全应用，覆盖开发者工具的各项操作链路。

### 🐳 部署与运维
- 以统一的 `deploy.sh` / `deploy.ps1` 取代旧版 `docker-deploy` 脚本，新增健康检查、日志跟踪、资源清理与向导式环境初始化，兼顾 Docker 与传统部署场景。
- 为 `docker-compose.yml`、`docker.env.example`、`env.traditional.example` 增加服务健康探针、资源配额及前端开关（如 `VITE_ENABLE_DEV_TOOLS`）等配置项。

### 📚 文档与测试工具
- 更新部署、安装与测试相关指南，使其与全新脚本和环境模板保持同步。
- 补充管理工具与运维守护的更新说明，方便后续维护与协作。

## [v1.0.1] - 2025-08-15

### 🔒 安全系统重大更新
- **用户名验证系统**: 新增完整的用户名验证工具，包含管理类、系统类、技术类、不雅词汇等4大类禁止使用的用户名
- **安全错误处理框架**: 新增安全错误处理系统，防止敏感信息泄露，提供统一的错误处理标准
- **格式验证增强**: 用户名长度限制(3-32字符)、字符类型限制(字母数字下划线)、下划线规则检查
- **安全防护**: 防止恶意注册和系统攻击，增强系统整体安全性

### 📧 邮件系统优化
- **智能连接降级**: 自动适应不同邮箱服务商的连接方式，支持SSL/TLS自动切换
- **连接失败重试**: 如果标准连接失败，自动尝试SSL作为备选方案
- **邮箱类型智能检测**: 针对163、Gmail等不同邮箱服务商优化连接参数
- **系统稳定性提升**: 提高邮件发送成功率，支持更多邮箱服务商

### ⚙️ 配置系统优化
- **Docker环境适配**: 优化默认配置以支持容器化部署，MySQL主机默认值改为"db"
- **验证邮件重发限制**: 新增验证邮件重发速率限制配置，防止邮件滥用
- **邮件配置环境变量**: 邮件TLS/SSL配置支持环境变量，提高配置灵活性
- **BASE_URL优化**: 移除硬编码端口号，提高跨环境兼容性

### 🐳 Docker部署系统重大升级
- **完整的健康检查系统**: 数据库和后端服务健康监控，自动重启失败的服务
- **资源限制和预留**: 生产级资源配置管理，CPU和内存限制配置
- **环境变量全面支持**: 所有关键配置支持环境变量，提高部署灵活性
- **服务依赖关系优化**: 等待数据库健康后再启动后端服务
- **跨平台部署脚本**: 新增Linux/macOS (deploy.sh) 和Windows PowerShell (deploy.ps1) 部署脚本

### 🧪 测试系统完善
- **测试配置管理**: 新增统一的测试环境配置管理文件 (test_config.py)
- **环境变量支持**: 修复所有测试文件中的硬编码API地址问题
- **配置验证**: 自动验证测试配置的有效性，支持不同测试环境
- **灵活URL构建**: 动态构建测试API地址，提高测试灵活性

### 🌐 前端功能更新
- **登录系统重构**: 支持邮箱或用户名双登录方式，优化登录体验
- **邮箱验证状态处理**: 登录后检查邮箱验证状态，提供明确的状态提示
- **API服务优化**: 移除硬编码地址，简化响应拦截器，支持访客模式
- **主题系统增强**: Docker生产环境主题支持，开发工具样式加载器集成
- **错误处理优化**: 更友好的错误提示，移除复杂的重定向逻辑

### 📚 文档系统更新
- **更新日志完善**: 中英文双语版本更新记录，详细的版本变更说明
- **部署指南完善**: 跨平台部署脚本说明，Docker环境配置详解
- **环境变量配置模板**: 提供完整的环境变量配置示例
- **故障排除指南**: 常见问题解决方案和部署建议

### 🔧 开发工具增强
- **更改保存系统**: 保存当前页面的更改，支持多页面数据管理
- **服务器同步**: 开发工具配置可保存到服务器，支持团队协作
- **代码导出优化**: 生成可导出的代码，支持CSS、JavaScript、JSON格式

### 📊 代码统计
- **新增文件**: 10个核心文件，包括安全工具、部署脚本、测试配置等
- **修改文件**: 13个主要文件，涵盖后端、前端、配置、测试等模块
- **代码行数**: 新增约800行，修改约300行，净增加约750行代码

---

## [v1.0.0] - 2025-08-14

### 初始发布
- 🚀 LAT-Lab 首次公开发布
- 📝 完整的内容管理系统
- 👥 用户管理系统
- 💬 评论交互系统
- 🔌 插件扩展系统
- 🛠️ 开发工具系统
- 🔒 安全防护系统
- �� 文件管理系统
- 📊 数据统计系统 